import{v,l as c,A as i,x as Y,_ as $,u as ee,y as ae,k as te,n as re,z as J,P as g,m as se,B as p,g as oe,d as C,c as l,f as r,t as y,s as _,F as f,q as G,C as ne,D as ie,H as ce,h as O,w as X,r as Z,o as d,I as le,p as de,i as ge}from"./index.a392570d.js";class he{async createChat(s){const n=await v.post("api/chats",s);c.log(n.data)}}const me=new he;class ye{async becomePlayer(s){const n=await v.post("api/players",s);c.log(n.data,"becoming a player"),i.players.push(new Y(n.data)),c.log(i.players,"new appstate player")}async getGatheringPlayers(s){const n=await v.get(`api/gatherings/${s}/players`);c.log("GETTING PLAYER",n.data),i.players=n.data.map(a=>new Y(a)),c.log(i.players,"all players")}async quit(s){c.log(s);const n=await v.delete(`api/players/${s}`);c.log(n.data),i.players=i.players.filter(a=>a.id!=s)}}const P=new ye;const _e={setup(){const m=ee(),s=ae({}),n=te();re(()=>{n.params.id,I(),b()}),m.beforeEach((e,o)=>{o.name=="Gathering"&&a(o.params.id)});function a(e){try{let o={gatheringName:e};J.emit("c:leaving:room",o)}catch(o){g.error("[error]",o.message)}}function I(){try{let e={gatheringName:n.params.gatheringId};J.emit("c:joining:room",e)}catch(e){g.error(e.message)}}async function x(){try{let e=n.params.gatheringId;await C.getGatheringById(e)}catch(e){c.error(e.message),g.error(e.message)}}async function w(){try{let e=n.params.gatheringId;await P.getGatheringPlayers(e)}catch(e){c.error(e.message),g.error(e.message)}}async function b(){try{let e=n.params.gatheringId;await C.getChats(e)}catch(e){g.error(e.message)}}return se(()=>{x(),w()}),{router:m,editable:s,chats:p(()=>i.chats),gathering:p(()=>i.activeGathering),players:p(()=>i.players),player:p(()=>i.players.find(e=>e.accountId==i.account.id)),isPlayer:p(()=>i.players.find(e=>e.accountId==i.account.id)),account:p(()=>i.account),async createChat(){try{let e=s.value;e.gatheringId=n.params.gatheringId,await me.createChat(e),s.value={}}catch(e){g.error("[error]",e.message)}},async getProfileGames(){try{i.profileGames=[],await oe.getProfileGames(i.account.id)}catch(e){c.error(e.message),g.error(e.message)}},async becomePlayer(e){try{await g.confirm("Become a Player?","")&&await P.becomePlayer({gatheringId:e}),this.gathering.capacity--}catch(o){c.error(o.message),g.error(o.message)}},async deleteGathering(e){try{await g.confirm("Are you sure you want to archive this gathering")&&await C.deleteGathering(e)}catch(o){c.error(o.message),g.error(o.message)}},async quit(e){try{await g.confirm("Are you sure you want to quit","")&&await P.quit(e),this.gathering.capacity++}catch(o){c.error(o.message),g.error(o.message)}},async goToGameDetails(e){try{c.log(e),m.push({name:"GameDetails",params:{gameId:e}})}catch(o){c.error(o.message),g.error(o.message)}},gotoProfile(e){c.log(e),m.push({name:"Profile",params:{accountId:e}})}}}},k=m=>(de("data-v-a8221f6c"),m=m(),ge(),m),pe={class:"row justify-content-center m-5"},ue={class:"col-md-10 p-0 bg-secondary rounded"},fe={class:"row"},ve={class:"col-md-8 py-3 px-5"},we={class:"ow-break-word"},be={key:0,class:"cancel-color"},Ce={class:"row"},Ge={class:"col-md-8 gatheringGamesSpot rounded p-2 d-flex align-items-center flex-wrap"},Pe=k(()=>r("h4",{class:"pe-2"},"Games:",-1)),ke=["title","src","alt","onClick"],Ie={class:"col-md-4 text-end goTop d-flex align-items-center"},xe=["src","alt"],Se={class:"col-9 text-end my-4"},De={class:"col-11 card bg-secondary"},Be=k(()=>r("h2",null,"Current Players",-1)),Ne={class:"d-flex flex-wrap"},Ee=["title","src","alt","onClick"],Me={class:"text-end"},je={class:"m-3"},qe={class:"m-2"},Te={key:0,class:"row m-2 justify-content-center"},Ae={class:"m-3 row"},Re={key:0,class:"row justify-content-end"},Fe={class:"col-md-7 mt-3 rounded-pill bg-secondary justify-content-end d-flex align-items-center"},Ve={class:"mx-4"},He={class:"col-1 text-end"},Ke=["src","alt"],Le={key:1,class:"row"},ze={class:"col-md-7 mt-3 rounded-pill bg-secondary d-flex align-items-center"},Qe={class:"col-1 me-5"},Ue=["src","alt"],We={class:""},Ye=k(()=>r("h5",{class:"text-dark"},"Edit Gathering!",-1));function Je(m,s,n,a,I,x){var e,o,S,D,B,N,E,M,j,q,T,A,R,F,V,H,K,L,z,Q;const w=Z("CreateGatheringForm"),b=Z("Modal");return d(),l(f,null,[r("section",pe,[r("div",ue,[r("section",fe,[r("div",ve,[r("div",we,[r("h1",null,y((e=a.gathering)==null?void 0:e.name),1),(o=a.gathering)!=null&&o.isCanceled?(d(),l("h1",be,"Cancelled")):_("",!0),r("h2",null,"Host: "+y((S=a.gathering)==null?void 0:S.creator.name),1),r("h4",null,y((D=a.gathering)==null?void 0:D.date),1),r("h4",null,y((B=a.gathering)==null?void 0:B.time),1),r("h5",null,y((N=a.gathering)==null?void 0:N.description),1),r("p",null,"Capacity: "+y((E=a.gathering)==null?void 0:E.capacity),1)]),r("div",Ce,[r("div",Ge,[Pe,(d(!0),l(f,null,G((M=a.gathering)==null?void 0:M.games,t=>(d(),l("img",{title:t==null?void 0:t.gameName,class:"gatheringGameCard selectable",key:t==null?void 0:t.id,src:t==null?void 0:t.gameImg,alt:t==null?void 0:t.gameName,onClick:h=>a.goToGameDetails(t==null?void 0:t.gameId)},null,8,ke))),128))])])]),r("div",Ie,[r("img",{class:"gathering-img",src:(j=a.gathering)==null?void 0:j.coverImg,alt:(q=a.gathering)==null?void 0:q.name},null,8,xe)])])]),r("div",Se,[!((T=a.gathering)!=null&&T.isCanceled)&&!a.isPlayer&&a.account.id?(d(),l("button",{key:0,onClick:s[0]||(s[0]=t=>{var h;return a.becomePlayer((h=a.gathering)==null?void 0:h.id)}),class:"btn btn-info border rounded-pill selectable"},"Become Player")):_("",!0),!((A=a.gathering)!=null&&A.isCanceled)&&a.isPlayer&&a.account.id?(d(),l("button",{key:1,onClick:s[1]||(s[1]=t=>{var h;return a.quit((h=a.player)==null?void 0:h.id)}),class:"btn btn-danger rounded-pill"},"Quit")):_("",!0)]),r("div",De,[r("div",null,[Be,r("div",Ne,[(R=a.gathering)!=null&&R.isCanceled?_("",!0):(d(!0),l(f,{key:0},G(a.players,t=>(d(),l("img",{class:"m-2 profile-img selectable",title:t.profile.name,src:t.profile.picture,alt:t.profile.name,onClick:h=>{var u;return a.gotoProfile((u=t.profile)==null?void 0:u.id)}},null,8,Ee))),256))])]),r("div",Me,[r("div",je,[!((F=a.gathering)!=null&&F.isCanceled)&&((V=a.account)==null?void 0:V.id)==((H=a.gathering)==null?void 0:H.creatorId)?(d(),l("button",{key:0,onClick:s[2]||(s[2]=t=>a.getProfileGames()),class:"btn btn-info border rounded-pill selectable","data-bs-toggle":"modal","data-bs-target":"#gatheringModal"},"Edit Gathering")):_("",!0)]),r("div",qe,[!((K=a.gathering)!=null&&K.isCanceled)&&((L=a.account)==null?void 0:L.id)==((z=a.gathering)==null?void 0:z.creatorId)?(d(),l("button",{key:0,onClick:s[3]||(s[3]=t=>{var h;return a.deleteGathering((h=a.gathering)==null?void 0:h.id)}),class:"btn btn-danger rounded-pill"},"Cancel Gathering")):_("",!0)])])])]),(Q=a.account)!=null&&Q.id?(d(),l("div",Te,[ne(r("textarea",{onKeydown:s[4]||(s[4]=ce(le(t=>a.createChat(m.chatData),["prevent"]),["enter"])),class:"rounded col-md-4 align-items-center py-2",placeholder:"Write a message...","onUpdate:modelValue":s[5]||(s[5]=t=>a.editable.body=t),name:"description",cols:"5",rows:"3"},null,544),[[ie,a.editable.body]])])):_("",!0),r("section",Ae,[(d(!0),l(f,null,G(a.chats,t=>{var h,u,U,W;return d(),l("div",{class:"col-12",key:t==null?void 0:t.id},[t.profileId==a.account.id?(d(),l("section",Re,[r("div",Fe,[r("p",Ve,y(t.body),1),r("div",He,[r("img",{src:(h=t.profile)==null?void 0:h.picture,alt:(u=t.profile)==null?void 0:u.name,class:"profilePicture"},null,8,Ke)])])])):(d(),l("section",Le,[r("div",ze,[r("div",Qe,[r("img",{src:(U=t.profile)==null?void 0:U.picture,alt:(W=t.profile)==null?void 0:W.name,class:"profilePicture"},null,8,Ue)]),r("p",We,y(t.body),1)])]))])}),128))]),O(b,{id:"gatheringModal"},{header:X(()=>[Ye]),modalBody:X(()=>[O(w)]),_:1})],64)}const Xe=$(_e,[["render",Je],["__scopeId","data-v-a8221f6c"]]);export{Xe as default};
